[作業履歴] 過去の履歴は作業履歴.txtに移した

2023/06/22:
H-111: imageDataの差分を求めるメソッドを作成する

2023/06/23:
H-110: 曲率半径が小さすぎる時は、tの更新が小さすぎないようにする -> 0.2以下は0.2にした。根拠なし
H-112: ロジック3の画素の座標から本来の座標を得るところで端っこでも [-0.1, 0.1] とすべきかなって思う -> ロジック3は不採用
H-113: なんかロジック2が猛烈に早い。getImageDataを頻発してたのが原因であった？
       ・tの更新式見直し(曲率半径の最大最小が気になる)
       ・ロジック1との速度比較 -> 10倍早い
       ・ベジェ曲線が直線の場合でも大丈夫か
       ・ベジェ曲線が小さい曲率半径を持つ場合でも大丈夫か
H-115: bezierImage2は色をクリアしないようにする

2023/06/24:
H-117: 作成した画像を調べてみる
    aが0の色成分とか

[こちらのチョーク画像の方がすごい]
https://www.ac-illust.com/main/profile.php?id=kWHdUmkj&area=1&page=2#comment-section

[チョークの画像]
https://www.photo-ac.com/main/search?q=%E3%83%81%E3%83%A7%E3%83%BC%E3%82%AF&%3Bpp=40&%3Bsrt=dlrank&%3Bp=406&pp=70&qt=&pt=B&p=1&sizesec=psd&srt=dlrank

[作業中]
H-123: 三角形塗りつぶしを実装する -> 動きが変。デバッグ中
H-122: やはり画像の曲げはロジック3で行くべきである
       ・x,yの割合を取得するところで start = points[0]; としているのはバグ
       ・変換後の座標から元の座標を取得し、そこから色を取得する
       ・tの変化量であるがこれは長さが1になるものを選べばよい

[優先度高め H-XXX]
H-107: 3次ベジェ曲線群の配列からアニメーションを作成する関数を作成する
(速度調整も付いているものとする)
・まずはBezierImageを拡張する
  ・追加が必要なもの 
    引数: 速度指定、前のBezierImageからの余った長さを受け取る、本メソッドで長さ余らせるかどうか(pathの最終ベジェ曲線なら長さは余らせない)
    戻り値: strokeArrayとお暗示構造を持ったフレームごとの画素のインデックスとその画素の色情報
            余った長さ
・3次ベジェ曲線群の配列と画像群からアニメーション用のフレーム情報を返す関数を作成する
  フレーム情報はチョークの座標と塗りつぶすインデックスと塗りつぶす色である必要がある。

H-120: 色の補完でbicubicも試してみたい
H-121: やっぱりアンチエイリアスが必要。でも直線のベクトル方向に描画しているのでその方向のみにエイリアスを掛ける
       意外と a=== 255以外のものが少ないのでアンチエイリアスは重要と思う
H-118: 色はa !== 0 の時は(255,255,255) であり、a === 0 の時は(0,0,0) なので、
       色の補完などはaの値のみやればよい

H-119: チョークの画像はaのみのファイルを作成すればよい
       ファイルのフォーマット
        4byte unsinged int : チョークの線の数 n
        loop n
          2byte unsinged int : チョーク画像の幅 w
          2byte unsinged int : チョーク画像の高さ h
        loop end
        loop n * w * h
          1byte unsinged int : チョークの画像のaの値
        loop end
H-116: ベジェ曲線の線分の長さを微分するメソッドを作成する
H-114: やはり2点を結ぶ直線の関数はアンチエイリアスが要る？そうしないとチョークの欠けた部分が目だないような気がする
-> これ線分詰めて描画するので、アンチエイリアスはあまり効果がないように思えるし、
   アンチエイリアスなしなら速度に期待できるので一旦なしで行きたいと考えている
H-108: チョーク用画像はもっと荒いモノが欲しい。チョークの線は細いので、小さい穴などはほぼ見えない
H-109: 輝度を平坦化したほうがよい？ [56, 123] => [0, 255]
H-103: www.ac-illust.comのチョーク画像を分割作成する
・chalk-line-1,2,3,4,5,6,7,8,9,10,chalk-line-simple -> 済み
H-102: フォントをインストールし、そのフォントでキャンバスに描画し、それを画像化する
H-065: exToPxメソッドを作りたい https://viereck.ch/latex-to-svg/
H-088: <rect> を横長前提に作ってしまっているので、修正する必要がある
H-049: エラーが発生する
\begin{eqnarray}
)\tag{2}
\end{eqnarray}
-> viewBoxが定義されていない<svg>が存在する。そんなのあってええんか？
-> なんだろう。svg viewerでも表示できないし、もうええかなって感じもする。
<svg
	xmlns="http://www.w3.org/2000/svg" width="100%" height="2.262ex" role="img" focusable="false"
	xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex; min-width: 10.283ex;">
という感じでスタイルが一応あるので、うーん考えてみようかなー

H-087: アニメーションはコントローラで定義しないといけない
H-066: Settingsを削除したい
H-058: 録画のテスト
H-047: そもそものtexによる色を変えた場合の対応
H-005: 線の太さを考慮した矩形計算 -> 対応してみたが幅が負の値になるようなときの処理をしていない

[優先度普通 M-XXX]
M-063: \huge{\bar x}でも https://viereck.ch/latex-to-svg/ ならうまく動く -> 最新版だとバグがある？ -> 3.0.0がよい？
M-071: hのmathjaxのコードがおかしい
       g は MJX-1-TEX-I-1D454
       h は MJX-2-TEX-I-210E
M-079: チョークのアニメーション作成時に前の線分の描画していないがそれでよいのか？
M-046: 画間の移動時(やや移動距離が長いとき？)は、手をほんの少し大きくした方がよい
M-014: 線の太さを変えるロジックを入れても面白いかもしれない
M-015: 初期の拡大率調査(※これもう一度調べたい)
  => 現状hugeをつけないと文字サイズが小さい件を調査する 
  => display以外効かないので、もうソフト的に拡大とマージンを設けた
M-017: primise error を調べる -> 恐らくfetchの時のerrorをcatchしていないため

[優先度低め L-XXX]
L-064: eqnarrayとか文字列をくくることができる https://viereck.ch/latex-to-svg/
L-048: チョークを持った手の画像のチョークの色をそもそも変えられるか？ 
-> 色の変更箇所を定義させる ←これで本当に行ける？色を変えたやつを用意した方がよいんじゃ？
L-071: 黒板が1消しできるようなら、1消しできるような向きにしてしまう。なるべく消す動作が少ない方向で
L-075: フリーハンドで塗る領域を決定するロジックってどう？
       普通にペンで領域作成させて塗りつぶすのが一番良いように思う
L-074: チョークの手や黒板消しの左右反転機能があってもよいかもしれない
L-013: アニメーション作成処理はマルチスレッドで行う
L-016:
・16進数コードから漢字に変換するプログラムを作成する(http://d.hatena.ne.jp/yasuhallabo/20140211/1392131668) -> うまくいっていない(保留)   
  https://gist.github.com/seekseep/e5c289791265dafee786640942ee2e4d -> これでもうまくいかない -> 16進数コードから日本語の復元がうまくいかない
  -> Bufferが使えるのはNodeのみなので、おそらくArrayBufferを使う
L-023
・Pixel.getAnimationPixelData で indexesArray を作成しないフラグを設けてもよいかもしれない -> フラグを設ける
L-001
図形のtexはいけない
以下がいけない。texclipではいける。うーん問題だね -> mathjaxは対応していないので、問題ではない
-> いや普通のtexならいける -> なので texが吐き出すdviファイルを利用するのが一番良いのかもしれない
\begin{picture}(40,40)(-20,-20)
  \put(-20,-20){\framebox(40,40){}}% 外見の領域全体を囲む枠
  \put(0,0){\circle*{4}}% 原点の位置
\end{picture}

[静止画切り取り調査]
https://rico-notes.com/design/bg-transparent/#toc7

[動画作成調査]
・ffmpeg.wasmがよいらしい
・最悪デスクトップアプリケーションに録画させる(mediaRecorder?)

[アイデア]
curves を stroke として定義したい
curvesArray を strokeArray として定義したい

[memo]
MathJax v3: TeX to SVG 正規のサンプルコード
https://mathjax.github.io/MathJax-demos-web/input-tex2svg.html

MathJaxのよいサンプル見つけた
https://viereck.ch/latex-to-svg/

mathjaxのsvg読み込みのサンプル
https://stackoverflow.com/questions/71031646/write-svg-latex-into-a-canvas-html

https://github.com/davidbau/seedrandom/tree/released
使い方のコピペ
Math.seedrandom('hello.');
console.log(Math.random());          // Always 0.9282578795792454
console.log(Math.random());          // Always 0.3752569768646784

チョーク風サンプル
https://codepen.io/mmoustafa/pen/AXprLM

チョークの色
https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q12148454412
黒板 rgba(29,84,63,1)
白 rgba(255,255,255,0.85)
黄色 rgba(255,255,146,0.85)
ピンク rgba(247,171,173,0.85)
青 rgba(126,203,220,0.85)


[太さの変わるBezier曲線の生成]
https://decafish.blog.ss-blog.jp/archive/c2300356243-3

[三角形塗りつぶし]
https://qiita.com/minosys/items/5375e6ffa049226943b0
これ移植してみようかな
